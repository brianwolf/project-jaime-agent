{
	"info": {
		"_postman_id": "16362a51-e513-4fbc-b8c1-dab521d64e7b",
		"name": "project-jaime-v0.1.0",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"item": [
		{
			"name": "api",
			"item": [
				{
					"name": "v1",
					"item": [
						{
							"name": "works",
							"item": [
								{
									"name": "list",
									"request": {
										"method": "GET",
										"header": [],
										"url": {
											"raw": "{{project-jaime}}/api/v1/works",
											"host": [
												"{{project-jaime}}"
											],
											"path": [
												"api",
												"v1",
												"works"
											]
										}
									},
									"response": []
								},
								{
									"name": "exec",
									"request": {
										"method": "POST",
										"header": [],
										"body": {
											"mode": "raw",
											"raw": "module: test\nservers:\n  from:\n    name: lasegunda4\n    namespace: msdesa\n    object: pod"
										},
										"url": {
											"raw": "{{project-jaime}}/api/v1/works/",
											"host": [
												"{{project-jaime}}"
											],
											"path": [
												"api",
												"v1",
												"works",
												""
											]
										}
									},
									"response": []
								},
								{
									"name": "logs",
									"request": {
										"method": "GET",
										"header": [],
										"url": {
											"raw": "{{project-jaime}}/api/v1/works/:id/logs",
											"host": [
												"{{project-jaime}}"
											],
											"path": [
												"api",
												"v1",
												"works",
												":id",
												"logs"
											],
											"variable": [
												{
													"key": "id",
													"value": "b5ec2ad4b7fb"
												}
											]
										}
									},
									"response": []
								},
								{
									"name": "New Request",
									"request": {
										"method": "GET",
										"header": [],
										"url": null
									},
									"response": []
								}
							]
						},
						{
							"name": "servers",
							"item": [
								{
									"name": "list",
									"request": {
										"method": "GET",
										"header": [],
										"url": {
											"raw": "{{project-jaime}}/api/v1/servers",
											"host": [
												"{{project-jaime}}"
											],
											"path": [
												"api",
												"v1",
												"servers"
											]
										}
									},
									"response": []
								},
								{
									"name": "get",
									"request": {
										"method": "GET",
										"header": [],
										"url": {
											"raw": "{{project-jaime}}/api/v1/servers/:name",
											"host": [
												"{{project-jaime}}"
											],
											"path": [
												"api",
												"v1",
												"servers",
												":name"
											],
											"variable": [
												{
													"key": "name",
													"value": "lasegunda4"
												}
											]
										}
									},
									"response": []
								},
								{
									"name": "delete",
									"request": {
										"method": "DELETE",
										"header": [],
										"url": {
											"raw": "{{project-jaime}}/api/v1/servers/:name",
											"host": [
												"{{project-jaime}}"
											],
											"path": [
												"api",
												"v1",
												"servers",
												":name"
											],
											"variable": [
												{
													"key": "name",
													"value": "lasegunda4"
												}
											]
										}
									},
									"response": []
								},
								{
									"name": "post",
									"request": {
										"method": "POST",
										"header": [],
										"body": {
											"mode": "raw",
											"raw": "{\n    \"name\": \"lasegunda4\",\n    \"url\": \"https://api.ocp01-noprod.ocplasegunda.com.ar:6443\",\n    \"token\": \"eyJhbGciOiJSUzI1NiIsImtpZCI6InpJZDZMSzRxVXJvRkJLMVdCb2FEclFJTWZubXdIaXVqbGIzVl9xbkdWbDAifQ.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJmcm9udC1kZXNhIiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZWNyZXQubmFtZSI6ImplbmtpbnMtZnJvbnQtYnVpbGRlci10b2tlbi0ycGRnaCIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VydmljZS1hY2NvdW50Lm5hbWUiOiJqZW5raW5zLWZyb250LWJ1aWxkZXIiLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlcnZpY2UtYWNjb3VudC51aWQiOiIxNWYzN2U2Ny03NGViLTRlYzgtOTliNi05Y2U5M2YxNzFjNjYiLCJzdWIiOiJzeXN0ZW06c2VydmljZWFjY291bnQ6ZnJvbnQtZGVzYTpqZW5raW5zLWZyb250LWJ1aWxkZXIifQ.GTCm9Vyabx2MNLpibzAxRRch-Cj7eJzbdG-b4knbjD2zKkDyLtRMcM92oOIa7XVA-vEIjAANsMOmiJ4nM7VwBxvqCmOY9B1Kg9ZKYc46OY6RLmMupr3dg8LRelb0UgKDX_Ln5o6XVyAzn8wtTwSUBWfwGzQzLX3G2EHWSwdvEAkI1bgEzulzVS-1t8Y1XmV3OBiDQN8u7iRml-NgSjpDvxfaK6Kin1Rvz5z8naC_cO6IE1SNQR-e7cp4cwhGB_J6rzOpGQoQNSPRpALPwipWEnzds3kr-WjqIXGE1J2QVGBWw89gODeCY6U0F9E9MuhN6O9gcsyu8R2AiAteFgk6LQ\",\n    \"version\": \"4.6\"\n}",
											"options": {
												"raw": {
													"language": "json"
												}
											}
										},
										"url": {
											"raw": "{{project-jaime}}/api/v1/servers/",
											"host": [
												"{{project-jaime}}"
											],
											"path": [
												"api",
												"v1",
												"servers",
												""
											]
										}
									},
									"response": []
								}
							]
						},
						{
							"name": "modules",
							"item": [
								{
									"name": "list",
									"request": {
										"method": "GET",
										"header": [],
										"url": {
											"raw": "{{project-jaime}}/api/v1/modules",
											"host": [
												"{{project-jaime}}"
											],
											"path": [
												"api",
												"v1",
												"modules"
											]
										}
									},
									"response": []
								},
								{
									"name": "get",
									"request": {
										"method": "GET",
										"header": [],
										"url": {
											"raw": "{{project-jaime}}/api/v1/modules/migrate_object",
											"host": [
												"{{project-jaime}}"
											],
											"path": [
												"api",
												"v1",
												"modules",
												"migrate_object"
											]
										}
									},
									"response": []
								},
								{
									"name": "delete",
									"request": {
										"method": "DELETE",
										"header": [],
										"url": {
											"raw": "{{project-jaime}}/api/v1/modules/migrate_object",
											"host": [
												"{{project-jaime}}"
											],
											"path": [
												"api",
												"v1",
												"modules",
												"migrate_object"
											]
										}
									},
									"response": []
								},
								{
									"name": "post",
									"request": {
										"method": "POST",
										"header": [],
										"body": {
											"mode": "raw",
											"raw": "import logging\nimport os\nimport re\nfrom typing import Dict\n\nimport yaml\n\nimport tools\n\n\ndef exec(params: Dict[str, any]):\n\n    server_from = params['servers']['from']['name']\n    namespace_from = params['servers']['from']['namespace']\n    object_from = params['servers']['from']['object']\n    only_from = params['servers']['from'].get('only', [])\n    ignore_from = params['servers']['from'].get('ignore', [])\n\n    server_to = params['servers']['to']['name']\n    namespace_to = params['servers']['to']['namespace']\n    method_to = params['servers']['to'].get('method', 'apply')\n\n    oc_from = tools.get_oc(server_from)\n    oc_from.login()\n\n    objects_to_migrate = [\n        ob\n        for ob\n        in oc_from.exec(f'get {object_from} -n {namespace_from} -o custom-columns=NAME:.metadata.name').split('\\n')[1:-1]\n    ]\n\n    tools.sh('mkdir yamls')\n\n    for ob in objects_to_migrate:\n\n        if only_from:\n            match_all_regex = len(\n                [regex for regex in only_from if re.match(regex, ob)]) == len(only_from)\n            if not match_all_regex:\n                continue\n\n        if ignore_from:\n            match_any_regex = any(\n                True for regex in ignore_from if re.match(regex, ob))\n            if match_any_regex:\n                continue\n\n        print(f'{server_from} -> Obteniendo {ob}')\n        oc_from.exec(\n            f'get {object_from} {ob} -n {namespace_from} -o yaml > yamls/{ob}.yaml')\n\n    oc_to = tools.get_oc(server_to)\n    oc_to.login()\n\n    yamls_to_migrate = [\n        nombre_archivo\n        for _, _, nombre_archivo in os.walk('yamls/')\n    ]\n    print(f'{server_to} -> Por migrar {len(yamls_to_migrate)} {object_from}')\n\n    yamls_errors = []\n    for yaml_to_migrate in yamls_to_migrate:\n        try:\n            with open(f'yamls/{yaml_to_migrate}') as file:\n                dic_yaml = yaml.load(file, Loader=yaml.FullLoader)\n\n            dic_yaml['metadata'].pop('creationTimestamp', None)\n            dic_yaml['metadata'].pop('namespace', None)\n            dic_yaml['metadata'].pop('resourceVersion', None)\n            dic_yaml['metadata'].pop('selfLink', None)\n            dic_yaml['metadata'].pop('uid', None)\n            dic_yaml.pop('status', None)\n\n            yaml_to_apply = yaml.dump(dic_yaml, default_flow_style=False)\n\n            tools.sh(\n                f'echo \"{yaml_to_apply}\" | {oc_to.server.binary_name()} {method_to} -n {namespace_to} -f -')\n            print(f'{server_to} -> Migrado {yaml_to_migrate}')\n\n        except Exception as e:\n            logging.exception(e)\n            logging.error(f'{server_to} -> ERROR al migrar {yaml_to_migrate}')\n\n            yamls_errors.append(yaml_to_migrate)\n            print(e.args)\n\n    if yamls_errors:\n        logging.error(f'{server_to} -> Yamls con errores al migrar:')\n        for y_error in yamls_errors:\n            logging.error(\n                f'{server_to} -> {y_error}')\n",
											"options": {
												"raw": {
													"language": "text"
												}
											}
										},
										"url": {
											"raw": "{{project-jaime}}/api/v1/modules/migrate_object",
											"host": [
												"{{project-jaime}}"
											],
											"path": [
												"api",
												"v1",
												"modules",
												"migrate_object"
											]
										}
									},
									"response": []
								}
							]
						}
					]
				}
			],
			"event": [
				{
					"listen": "prerequest",
					"script": {
						"type": "text/javascript",
						"exec": [
							""
						]
					}
				},
				{
					"listen": "test",
					"script": {
						"type": "text/javascript",
						"exec": [
							""
						]
					}
				}
			]
		},
		{
			"name": "app",
			"item": [
				{
					"name": "alive",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{project-jaime}}",
							"host": [
								"{{project-jaime}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "vars",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{project-jaime}}/vars",
							"host": [
								"{{project-jaime}}"
							],
							"path": [
								"vars"
							]
						}
					},
					"response": []
				}
			],
			"event": [
				{
					"listen": "prerequest",
					"script": {
						"type": "text/javascript",
						"exec": [
							""
						]
					}
				},
				{
					"listen": "test",
					"script": {
						"type": "text/javascript",
						"exec": [
							""
						]
					}
				}
			]
		}
	],
	"event": [
		{
			"listen": "prerequest",
			"script": {
				"type": "text/javascript",
				"exec": [
					""
				]
			}
		},
		{
			"listen": "test",
			"script": {
				"type": "text/javascript",
				"exec": [
					""
				]
			}
		}
	],
	"variable": [
		{
			"key": "project-jaime",
			"value": "http://localhost:5000"
		}
	]
}